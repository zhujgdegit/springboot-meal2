<!--
                ___           ___           ___           ___           ___
               /\__\         /\  \         /\  \         /\  \         /\__\
              /::|  |       /::\  \       /::\  \       /::\  \       /:/  /
             /:|:|  |      /:/\:\  \     /:/\:\  \     /:/\:\  \     /:/  /
            /:/|:|  |__   /::\~\:\  \   /:/  \:\  \   /:/  \:\  \   /:/  /
           /:/ |:| /\__\ /:/\:\ \:\__\ /:/__/ \:\__\ /:/__/ \:\__\ /:/__/
           \/__|:|/:/  / \/__\:\/:/  / \:\  \  \/__/ \:\  \  \/__/ \:\  \
               |:/:/  /       \::/  /   \:\  \        \:\  \        \:\  \
               |::/  /        /:/  /     \:\  \        \:\  \        \:\  \
               /:/  /        /:/  /       \:\__\        \:\__\        \:\__\
               \/__/         \/__/         \/__/         \/__/         \/__/
-->
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head th:replace="admin/_fragments :: head(~{::title})">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View User Orders</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
    <link rel="stylesheet" href="../../static/css/me.css" th:href="@{/css/me.css}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Naccl/blog-resource/github-badge.min.css">
</head>
<body class="site">

<!-- Navigation -->
<nav th:replace="admin/_fragments :: menu(4)" class="ui inverted attached segment m-padded-tb-mini m-shadow-small">
</nav>

<div class="site-content">

    <!-- Middle Content -->
    <div class="m-container-small m-padded-tb-big">
        <div class="ui container">

            <!-- Display message if not empty -->
            <div class="ui success message" th:unless="${#strings.isEmpty(message)}">
                <i class="close icon"></i>
                <div class="header">Notice:</div>
                <p th:text="${message}">Operation successful!</p>
            </div>
            <!-- Search -->
            <div class="ui secondary segment form">
                <!-- Used to pass 'page' for previous and next page -->
                <input type="hidden" name="page">

                <div class="inline fields">
                    <div class="field">
                        <input type="text" name="ordCode" placeholder="Enter Order Code">
                    </div>

                    <div class="field">
                        <button type="button" id="search-btn" class="ui teal basic button"><i class="search icon"></i>Search</button>
                    </div>
                </div>
            </div>

            <dev id="table-container" th:fragment="orderList">
                <table class="ui teal table m-text" style="text-align:center;">
                    <thead>
                    <tr>
                        <th>USER NAME</th>
                        <th>PHONE</th>
                        <th>DISH NAME</th>
                        <th>ORDER CODE</th>
                        <th>CREATE TIME</th>
                        <th>STATE</th>
                        <th>APPRAISE</th>
                        <th>OPERATE</th>
                    </tr>
                    </thead>

                    </tbody>
                    <tbody>
                    <tr th:each="item : ${orderMap}">
                        <td th:text="${item[0]}"></td> <!-- First field is user name -->
                        <td th:text="${item[1]}"></td> <!-- User phone -->
                        <td th:text="${item[2]}"></td> <!-- Second field is dish name -->
                        <td th:text="${item[3]}"></td> <!-- Order code -->
                        <td th:text="${item[4]}"></td> <!-- Create time -->
                        <td th:text="${item[5]}"></td> <!-- Second field is order state -->
                        <td th:text="${item[6]}"></td> <!-- Dish appraisal -->
                        <td style="padding:5px">
                            <a onclick="del(this)" th:data-href="@{/admin/orders/deleteByCode(ordCode=${item[3]})}" class="ui mini red basic button" style="padding:8px 10px">Delete</a>
                            <a th:if="${item[5] == 'PENDING'}" onclick="update(this)" th:data-href="@{/admin/orders/updateByCode(ordCode=${item[3]})}" class="ui mini red basic button" style="padding:8px 10px">Accept</a>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </dev>
        </div>
    </div>
    <!-- Confirmation Modal -->
    <div class="ui basic modal">
        <div class="ui icon header"><i class="trash alternate outline icon"></i>Delete</div>
        <div class="content"><h1>Are you sure you want to delete this order?</h1></div>
        <div class="actions">
            <div class="ui basic cancel inverted button"><i class="remove icon"></i>Cancel</div>
            <div id="ok" class="ui red ok inverted button"><i class="checkmark icon"></i>Delete</div>
        </div>
    </div>
</div>

<!-- Footer -->
<footer th:replace="_fragments :: footer" class="ui inverted vertical segment">
</footer>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.2/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>

<script>
    var ordCode = "";
    var url;
    $("#search-btn").click(function () {
        ordCode = $("[name='ordCode']").val();
        loadData();
    });

    function loadData() {
        $("#table-container").load("/admin/orders/search", {
            ordCode: ordCode
        });
    }
    function del(obj){
        url = $(obj).attr('data-href');
        $('.ui.basic.modal').modal('show');
    }
    $('#ok').click(function () {
        window.location.href = url;
    });
    function update(obj){
        url = $(obj).attr('data-href');
    }
</script>
</body>
</html>
